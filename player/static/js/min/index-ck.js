playerApp.factory("DataList",function(){var a=[{id:0,artist:"Lene Marlin",song:"A Place Nearby",album:"《Playing My Game》",songUrl:"/static/music/A Place Nearby.mp3",avatar:"/static/img/lm.jpg"},{id:1,artist:"David Archuleta",song:"Crush",album:"《David Archuleta》",songUrl:"/static/music/Crush.mp3",avatar:"/static/img/da.jpg"},{id:2,artist:"Lucie Arnaz",song:"I still Believe In Love",album:"《They'Re Playing Our Song》",songUrl:"/static/music/I Still Believe In Love.mp3",avatar:"/static/img/la.jpg"},{id:3,artist:"Jem",song:"It's Amazing",album:"《Sex And The City - Original Motion Picture Soundtrack》",songUrl:"/static/music/It'S Amazing.mp3",avatar:"/static/img/jem.jpg"},{id:4,artist:"Jewel",song:"Stay Here Forever",album:"《Sweet And Wild》",songUrl:"/static/music/Stay Here Forever.mp3",avatar:"/static/img/jew.jpg"},{id:5,artist:"Lenka",song:"The Show",album:"《#LOVE acoustic》",songUrl:"/static/music/The Show.mp3",avatar:"/static/img/lenka.jpg"},{id:6,artist:"Tamas Wells",song:"Valder Fields",album:"《A Plea En Vendredi》",songUrl:"/static/music/Valder Fields.mp3",avatar:"/static/img/tw.jpg"}];return a}),playerApp.factory("DataBinding",["$rootScope","DataList",function(a,t){a.datas=t;var e={dataBindFunc:function(t){a.avatar=a.datas[t].avatar,a.artist=a.datas[t].artist,a.song=a.datas[t].song,a.album=a.datas[t].album}};return e}]),playerApp.factory("Audio",["$document",function(a){var t=a[0].createElement("audio");return t}]),playerApp.factory("Player",["$rootScope","$interval","Audio","DataList","DataBinding",function(a,t,e,i,n){a.data=i;var r={playing:!1,active:"0",musicLen:"7",playTime:"-0:00",controllPlay:function(t){var i=a.data[t].songUrl;e.src=i,e.play(),n.dataBindFunc(t),r.playing=!0},play:function(a){r.playing&&r.stop(),r.controllPlay(a)},stop:function(){r.playing&&e.pause(),r.playing=!1},prev:function(){console.log("prev:"+r.active),0==r.active?r.active=r.musicLen-1:r.active-=1,r.controllPlay(r.active)},next:function(a){console.log("next:"+r.active),r.active==r.musicLen-1?r.active=0:r.active+=1,r.controllPlay(r.active)},surplusBar:function(){if(!isNaN(e.duration)){var a=e.duration-e.currentTime,t=parseInt(a/60),i=parseInt(a%60);10>i&&(i="0"+i),r.playTime="-"+t+":"+i;var n=e.currentTime/e.duration*1e3;r.surplusWidth="width:"+parseInt(n)+"px"}},bufferBar:function(){bufferTimer=t(function(){var a=e.buffered.length;if(a>0&&void 0!=e.buffered){var t=e.buffered.end(a-1)/e.duration*1e3;r.bufferWidth="width:"+parseInt(t)+"px",Math.abs(e.duration-e.buffered.end(a-1))<1&&(r.bufferWidth="width: 1000px",clearInterval(bufferTimer))}},1e3)}};return e.addEventListener("timeupdate",function(){a.$apply(r.surplusBar())}),e.addEventListener("canplay",function(){a.$apply(r.bufferBar())}),r}]),playerApp.directive("musicMode",["$timeout","$document",function(a,t){return{restrict:"AE",replace:!0,scope:{player:"=",audio:"="},templateUrl:"/tpls/mode.html",link:function(e,i,n){var r="list";e.addActive=function(a){i.children("li").removeClass("active"),i.children("li").eq(a).addClass("active")},e.addActive(0),e.listPlay=function(){r="list",console.log("list"),e.addActive(0)},e.randomPlay=function(){console.log("random"),r="random",e.addActive(1)},e.repeatPlay=function(){r="repeat",console.log("repeat"),e.addActive(2)},e.audio.addEventListener("ended",function(){if("list"==r)e.player.active==e.player.musicLen-1?e.player.active=0:e.player.active+=1;else if("random"==r){var a=parseInt(e.player.musicLen*Math.random());console.log("randomPlay"+a),a==e.player.active&&(a+=1),e.player.active=a}else console.log("repeat");e.$apply(e.player.controllPlay(e.player.active))});var l;e.volShow=!1,e.showVol=function(){e.volShow=!0,clearTimeout(l)},e.hideVol=function(){l=a(function(){e.volShow=!1},300)},e.volStyle="height: 64px",e.audio.volume=.8,e.adjustVolume=function(a){var i=window.event||a,n=t[0].querySelector(".play-vol").getBoundingClientRect().bottom-i.clientY;e.audio.volume=(n/75).toFixed(2),e.volStyle="height:"+n+"px"},e.muted=!0,e.audioMuted=function(){0==e.audio.muted?(e.audio.muted=!0,e.muted=!1):(e.audio.muted=!1,e.muted=!0)}}}}]),playerApp.controller("playerCtrls",["$scope","DataList","DataBinding","Audio","Player","$timeout",function(a,t,e,i,n,r){e.dataBindFunc(0),a.player=n,a.audio=i,a.player.active=0,a.isSelected=function(){a.player.active=this.$index,e.dataBindFunc(a.player.active),n.play(a.player.active)}}]);